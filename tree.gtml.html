<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <!--    Libraries:    -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <script src="js/lib/jquery.min.js"></script>
      <script src="js/lib/bootstrap.min.js"></script>
      <script src="js/lib/d3.js"></script>
    
      <!--    Custom Scripts:   -->
      <link rel="stylesheet" href="css/nodeStyles.css">
      <script src="js/dataHandler.js"></script>
      <script src="js/data.js"></script>
      <script src="js/d3_scripts.js"></script>
      <!--    Test Scripts    -->
      <script src="js/testing.js"></script>
     

    <title></title>

  </head>

  <body>

<script>

// ************** Generate the tree diagram	 *****************
var margin = {top: 20, right: 120, bottom: 20, left: 120},
	width = 960 - margin.right - margin.left,
	height = 700 - margin.top - margin.bottom;

var offsetX = 100, offsetY=height/2;

var scalMin = 0.4, scaleMax = 7;
	
var i = 0,
	duration = 500,
	root;

var tree = d3.layout.tree()
	//.size([height, width]);
  .nodeSize([25, 20]);  //add to have equal spacing, remove the previous line. nodeSize won't work along with size()

var diagonal = d3.svg.diagonal()
	.projection(function(d) { return [ d.y, d.x]; });   //{ return [d.y, d.x]; });
                                                                              //{ return [ d.y + rectH / 2, d.x + rectW / 2]; }

var div = d3.select("body").append("div")
  .style("border-style", "solid")
  .style("border-width", "2px")
  .style("width", width + margin.right + margin.left + 10 + "px")
  .style("height", height + margin.top + margin.bottom + 10 + "px");


var zoom = d3.behavior.zoom()
            .scaleExtent([scalMin, scaleMax])
            .on("zoom", redraw);


var svg = d3.select("div").append("svg")
	.attr("width", width + margin.right + margin.left)
	.attr("height", height + margin.top + margin.bottom)
    //.append("g")
    //.call(d3.behavior.zoom().scaleExtent([0.6, 8]).on("zoom", zoom))
    .call(zoom)
  .append("g")
	.attr("transform", "translate(" + offsetX + "," + offsetY + ")");

//------------ Zooming ------------


function redraw() {
     d3.select("svg").select("g").attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")");
 }

// function for handling zoom event
function zoom() {
 svg.attr("transform", "translate(" + (d3.event.translate[0]  + offsetX) + ","   + (d3.event.translate[1] + offsetY )+ ")scale(" + d3.event.scale + ")");

}

//---------------------------------

//defining starting point 
root = treeData[0]

root.x0 = height / 2;
root.y0 = 0;
  
update(root);

d3.select(self.frameElement).style("height", "500px");

 // var delay = setInterval(function(){newNewChild(0,0);},100);

testCreating();



</script>


<script>
var addedRadiosNamesType1 = [];
var addedRadiosNamesType2 = [];
function testClick1(){

  var name =  "" + Math.floor(Math.random() * (10000 - 1 + 1)) + 1;
addElementAndGroup(treeData[0],"BTS2-1",["name", name, "type","Radio", "property1", "test"]);
addedRadiosNamesType1.push(name);
}
function testClick2(){
var name =  "" + Math.floor(Math.random() * (10000 - 1 + 1)) + 1;
addElementAndGroup(treeData[0],"BTS2-1",["name", name, "type","RadioNEW", "property1", "test"]);
addedRadiosNamesType2.push(name);
}

function testDeleteAndUngroupUsage1(){
  var name = addedRadiosNamesType1.shift();
  //console.log("Delete " + name);
  delElementAndUngroup(treeData[0],name);
}

function testDeleteAndUngroupUsage2(){
  var name = addedRadiosNamesType2.shift();
  delElementAndUngroup(treeData[0],name);
}

function testLink(startNodeName, endNodeName){


  var nodes = d3.selectAll(".node");//.data();
  console.log(nodes);
  var node1 = nodes.filter( function(d,i){return d.name == "Radio1" ;} )
  var node2 = nodes.filter( function(d,i){return d.name == "Radio2" ;} )
  console.log(node1);
  //TODO here find out if both nodes exist
//debugger;
var pointX = node2.data()[0].y;
var pointY = node2.data()[0].x;

var lineDataEnd = [{ "x":pointX, "y":pointY },{ "x":pointX, "y":pointY }];

console.log("begin x: " + node1.data()[0].y);
console.log("begin y: " + node1.data()[0].x);

console.log("end x: " + pointX);
console.log("end y: " + pointY);

var lineData = [  { "x": 0,   "y": 0}, 
                  { "x": 50,   "y": 0}, 
                  { "x":0, "y":pointY*2 } ];
 
 //This is the accessor function we talked about above
 var lineFunction = d3.svg.line()
                      .x(function(d) { return d.x; })
                      .y(function(d) { return d.y; })
                      .interpolate("basis");


//The line SVG Path we draw
var lineGraph = node1.append("path")
                    .attr("d", lineFunction(lineData))
                    .attr("stroke", "blue")
                    .attr("stroke-width", 2)
                    .attr("fill", "none");


}
testLink();

function centerView(){

 var _svg = d3.select("svg").select("g");
       zoom.translate([offsetX, offsetY]);
       zoom.scale(1);
       _svg.transition()
           .duration(750)
           .attr("transform", "translate(" + offsetX + "," + offsetY + " )scale(1)");

}
centerView(); //has to be called right away during initialization
</script>


<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;}
.tg .tg-baqh{text-align:center;vertical-align:center}
.tg .tg-yw4l{vertical-align:top}
</style>
<table class="tg">
  <tr>
    <th class="tg-baqh">Type1</th>
    <th class="tg-baqh"><button type="button" class="btn btn-primary btn-lg" onclick="testClick1()">Add</button></th>    
    <th class="tg-baqh"><button type="button" class="btn btn-primary btn-lg" onclick="testDeleteAndUngroupUsage1()">Delete Type1</button></th>
  </tr>
  <tr>
    <th class="tg-baqh">Type2</th>
    <td class="tg-baqh"><button type="button" class="btn btn-primary btn-lg" onclick="testClick2()">Add</button></td>
    <td class="tg-baqh"><button type="button" class="btn btn-primary btn-lg" onclick="testDeleteAndUngroupUsage2()">Delete Type2</button></td>
  </tr>
  <tr>
    <th class="tg-baqh">Functions</th>
    <td class="tg-baqh"><button id="centerButton" type="button" class="btn btn-primary btn-lg" onclick="centerView()" >Center View</button></td>
    <td class="tg-baqh"><button type="button" class="btn btn-primary btn-lg" onclick="testLink()">testLink</button></td>
  </tr>
</table>

  </body>
</html>